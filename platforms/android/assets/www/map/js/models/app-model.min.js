suApp.model.AppModel=Backbone.Model.extend({defaults:{menu:!1,filterByCampus:!1,campus:new suApp.model.Campus({name:"Frescati"}),types:[],nonVisibleTypes:[],zoomSensitive:!1,showingNonVisibleForLocation:null},initialize:function(){_.bindAll(this,"showVisibleTypes","hideAllNonVisibleTypes","handleLocationsReset","handleVisibilityForLocationByRelation");this.campuses=new suApp.collection.Campuses;this.locations=new suApp.collection.Locations(null,{searchableTypes:_.difference(this.get("types"),this.get("nonVisibleTypes"))});
this.locations.on("reset",this.handleLocationsReset);(this.get("menu")||this.get("filterByCampus"))&&this.campuses.fetch({reset:!0})},getFilterCollection:function(){return this.get("filterByCampus")?this.campuses:this.locations},fetchLocations:function(){this.locations.fetch({data:{types:this.get("types")},error:function(){var b=i18n.t("error.connectionlost");showError(b)},reset:!0})},showVisibleTypes:function(){var b=this.get("nonVisibleTypes");this.locations.each(function(a){_.contains(b,a.get("type"))||
a.set("visible",!0)})},hideAllNonVisibleTypes:function(){var b=this.get("nonVisibleTypes");this.locations.each(function(a){_.contains(b,a.get("type"))&&a.set("visible",!1)})},hideAllModelsExceptOne:function(b){this.locations.each(function(a){a!=b&&a.set("visible",!1)});b.set("visible",!0)},handleLocationsReset:function(){this.hideAllNonVisibleTypes();this.showVisibleTypes()},handleVisibilityForLocationByRelation:function(b,a,d,e){this.hideAllNonVisibleTypes();var c=a?this.locations["by"+a.charAt(0).toUpperCase()+
a.slice(1)]:null,f=null;c&&(c=c.call(this.locations,b).filter(function(a){return _.contains(d,a.get("type"))}),_.invoke(c,"set","visible",e),e&&(f={location:b,relatedBy:a,types:d}));this.set("showingNonVisibleForLocation",f)}});