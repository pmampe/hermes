suApp.view.InfoWindowView=Backbone.View.extend({infoWindow:null,destination:null,initialize:function(a){_.bindAll(this,"open","close","updateRelatedLinks");this.appModel=a.appModel;this.appModel.on("change:showingNonVisibleForLocation",function(){var a=this.appModel.get("showingNonVisibleForLocation");this.updateRelatedLinks(a?a.location:null)},this);this.infoWindow=new google.maps.InfoWindow({maxWidth:260});var c=this;$(document).on("click.info-window-view",".iw .dir-button",function(){c.close();
$(".dir-button").each(function(){$(this).removeClass("selected")});$(this).addClass("selected");a.mapView.getDirections(this.id,c.destination)})},remove:function(){this.close();$(document).off(".info-window-view");Backbone.View.prototype.remove.call(this)},setDestination:function(a){this.destination=a},open:function(a,c,g){this.close();var b={name:a.getI18n("name"),displayDirections:a.get("directionAware"),model:a,itemText:a.getI18n("text")};if("building"===a.get("type")){var d=0<this.appModel.locations.byBuildingAndTypeAndHandicapAdapted(a,
["elevator"],!0).size(),f=0<this.appModel.locations.byBuildingAndTypeAndHandicapAdapted(a,["entrance"],!0).size(),k=this.appModel.locations.byBuildingAndTypeAndHandicapAdapted(a,["toilet"],!0),e=[];_.each(_.flatten(k),function(a){e.push(a.get("floor"))});e=_.uniq(e.sort(),!0).join(", ");b.hasElevators=d;b.hasEntrances=f;b.tFloors=e}"organization"===a.get("type")&&(d=a.get("webAddress"),null!=d?(f=d.replace("http://","").replace("www.",""),b.webAddressShort=f):b.webAddressShort="",b.telephoneNumber=
a.get("telephoneNumber"),b.webAddress=d,b.mailAddresses=a.get("mailAddresses"),b.address=a.get("address"),b.postalCity=a.get("postalCity"),b.postalCode=a.get("postalCode"));b=JST["map/infoWindow"](b);this.infoWindow.setContent(b);g?(this.infoWindow.setPosition(g),this.infoWindow.open(c.getMap())):this.infoWindow.open(c.getMap(),c);var h=this;$("a.showRelated","#info_window").click(function(){var b=$(this);h.appModel.handleVisibilityForLocationByRelation(a,b.data("related-by"),b.data("related-types").split(" "),
!0)});$("a.hideRelated","#info_window").click(function(){var b=$(this);h.appModel.handleVisibilityForLocationByRelation(a,b.data("related-by"),b.data("related-types").split(" "),!1)});this.updateRelatedLinks(a)},updateRelatedLinks:function(a){$("a.showRelated","#info_window").show();$("a.hideRelated","#info_window").hide();var c=this.appModel.get("showingNonVisibleForLocation");c&&a===c.location&&(a='[data-related-by\x3d"'+c.relatedBy+'"][data-related-types\x3d"'+c.types.join(" ")+'"]',$("a.showRelated"+
a,"#info_window").hide(),$("a.hideRelated"+a,"#info_window").show())},close:function(){this.infoWindow&&this.infoWindow.close()}});